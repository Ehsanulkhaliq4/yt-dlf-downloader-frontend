<mat-card class="progress-card">
  <mat-card-header>
    <mat-card-title class="progress-title">
      <mat-icon [color]="getStatusColor()" class="status-icon">
        {{ getStatusIcon() }}
      </mat-icon>
      {{ progress.percentage >= 100 ? 'Download Complete' : 'Download Progress' }}
    </mat-card-title>
    <mat-card-subtitle>
      ID: {{ progress.downloadId.substring(0, 8) }}...
      <span class="last-update">(Updated: {{ formatTime(progress.lastUpdate) }})</span>
    </mat-card-subtitle>

    <button mat-icon-button class="close-button" (click)="onClose()" [disabled]="isLoading">
      <mat-icon>close</mat-icon>
    </button>
  </mat-card-header>

  <mat-card-content>
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Connecting to download server...</p>
    </div>

    <!-- Progress Content -->
    <div *ngIf="!isLoading" class="progress-content">
      <!-- Progress Bar -->
      <div class="progress-section">
        <mat-progress-bar [color]="getProgressColor()" [value]="progress.percentage" mode="determinate"
          class="progress-bar">
        </mat-progress-bar>
        <div class="percentage">{{ progress.percentage.toFixed(1) }}%</div>
      </div>

      <!-- Progress Details -->
      <div class="progress-details">
        <div class="detail-row">
          <div class="detail-item">
            <mat-icon class="detail-icon">speed</mat-icon>
            <div class="detail-content">
              <span class="detail-label">Speed</span>
              <span class="detail-value">{{ progress.speed }}</span>
            </div>
          </div>

          <div class="detail-item">
            <mat-icon class="detail-icon">schedule</mat-icon>
            <div class="detail-content">
              <span class="detail-label">ETA</span>
              <span class="detail-value">{{ progress.eta }}</span>
            </div>
          </div>
        </div>

        <div class="detail-row">
          <div class="detail-item">
            <mat-icon class="detail-icon">info</mat-icon>
            <div class="detail-content">
              <span class="detail-label">Status</span>
              <span class="detail-value status-text" [class]="getStatusColor()">
                {{ progress.status }}
              </span>
            </div>
          </div>

          <div class="detail-item">
            <mat-icon class="detail-icon">update</mat-icon>
            <div class="detail-content">
              <span class="detail-label">Last Update</span>
              <span class="detail-value">{{ formatTime(progress.lastUpdate) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Completion Message -->
      <div *ngIf="progress.percentage >= 100" class="completion-message">
        <mat-icon color="primary">check_circle</mat-icon>
        <span>Download completed successfully! This dialog will close automatically.</span>
      </div>
    </div>
  </mat-card-content>
</mat-card>